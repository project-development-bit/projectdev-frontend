<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />

  <!-- Orbitron font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="login-style.css" />
</head>

<body>
  <div class="login-wrapper">

    <!-- EMAIL -->
    <div class="input-group" id="email-group">
      <img src="icons/email.svg" class="icon" alt="email" />
      <input id="email" type="email" placeholder="Email" autocomplete="username" />
    </div>
    <div class="error-text" id="email-error"></div>

    <!-- PASSWORD -->
    <div class="input-group" id="password-group">
      <img src="icons/lock.svg" class="icon" alt="lock" />
      <input id="password" type="password" placeholder="Password" autocomplete="current-password" />
      <img src="icons/eye-open.svg" class="eye" id="toggleEye" alt="toggle password" />
    </div>
    <div class="error-text" id="password-error"></div>

  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
      const toggleEye = document.getElementById("toggleEye");

      // Autofocus email
      emailInput.focus();

      // Enter on email → focus password
      emailInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          passwordInput.focus();
        }
      });

      // Enter on password → submit to Flutter
      passwordInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          submitLogin();
        }
      });

      // Toggle password visibility
      toggleEye.addEventListener("click", () => {
        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          toggleEye.src = "icons/eye-close.svg";
        } else {
          passwordInput.type = "password";
          toggleEye.src = "icons/eye-open.svg";
        }
      });

      // Receive messages from Flutter
      window.addEventListener("message", (event) => {
        const data = event.data;

        if (data?.type === "REQUEST_LOGIN_DATA") {
          submitLogin();
        }

        if (data?.type === "SHOW_ERRORS") {
          setError("email", data.emailError);
          setError("password", data.passwordError);
        }

        if (data?.type === "CLEAR_ERRORS") {
          setError("email", null);
          setError("password", null);
        }
      });

      function submitLogin() {
        window.parent.postMessage(
          JSON.stringify({
            type: "LOGIN_DATA",
            email: emailInput.value,
            password: passwordInput.value,
          }),
          "*"
        );
      }

      function setError(field, message) {
        const group = document.getElementById(`${field}-group`);
        const error = document.getElementById(`${field}-error`);

        if (message) {
          group.classList.add("error");
          error.textContent = message;
        } else {
          group.classList.remove("error");
          error.textContent = "";
        }
      }
    });
  </script>
</body>

</html>